# IP

### IP (Internet Protocol)
- 3계층인 네트워크 계층에서 사용되는 프로토콜으로 복잡한 인터넷 망 속에서 클라이언트와 서버간 원활하게 통신할 수 있는 규칙. 
- 인터넷여 연결되어 있는 모든 장치는 식별이 가능하도록 각각 고유 주소인 IP를 부여
- IP는 지정한 IP 주소에 패킷(Packet)이라는 통신 단위로 데이터를 전달 ([Packet 설명링크](./Packet.md))
- IP는 <code>공인IP와 사설 IP</code>가 존재. 공유기를 사용한 인터넷 접속일 경우 공유기까지는 공인IP를 할당하지만 공유기에 연결되어 있는 가정이나 각 네트워키 기기에는 사설 IP를 할당

<br>

## Ssafy Wizards CS Study

### 1. IPv4와 IPv6 의 차이
#### IPv4
- 32자리(32bit)의 이진수를 8자리(8bit)씩 쪼개어 십진수로 만들고, 가운데 점을 찍어 각 마디을 옥텟이라고 부르며 이를 보기 쉽게 헥사 값으로 변경
- 각 영역의 숫자는 0~255 까지의 숫자로 표현할 수 있음 ->  2^32 = 약 43억개의 주소를 사용할 수 있음
- 가변 헤더를 가지며 크기가 20bytes ~ 60bytes
    - 헤더가 상대적으로 복잡하며 필드가 많고 체크섬 필드와 같은 추가적인 필드가 존재
- 주소를 수동으로 할당하거나 DHCP(Dynamic Host Comnfiguration Protocol)를 통해 동적으로 할당
- NAT(Network Address Transalation)를 많이 사용하여 사설 IP주소와 공인 IP 주소 간의 변환을 통해 주소 부족 문제를 완화
- 보안 기능이 프로토콜의 선택적 추가 사항
- 송신자와 라우터 모두에서 패킷의 프래그멘테이션(분할)이 가능
- 브로드캐스트 기능이 있으며, 네트워크 상의 모든 호스트에게 패킷을 전달할 수 있음
- 수동으로 설정하거나 DHCP를 통해 자동으로 할당
- IPv4 라우터에서는 tunneling이라는 방식을 사용해 IPv6 데이터그램을 전송

#### IPv6
- 총 128bit로 각 16비트씩 8자리로 각 자리는 콜론(:)으로 구분하고 있음 
- 주소가 부족함에 따라 IPv6 개발. 그러나 아직까지 많은 라우터들이 IPv4를 사용하고 있고 IPv6 전환에는 오랜 시간이 걸릴걸로 예상
- 2^128 = 어마어마한 양의 주소 사용 가능
- 고정 헤더크기는 40bytes. 헤더 크기는 커졌으나 기능을 간략화
- 자동으로 주소를 설정할 수 있는 SLAAC 와 DGCPv6를 지원
- IPsec을 필수적으로 지원하여 보안 기능이 기본적으로 포함
- 주소 공간이 매우 넓어 NAT를 사용할 필요가 거의 없어 이를 통해 엔드투엔드 연결을 촉진
- 송신자는 프래그멘테이션을 할 수 없으며, 오직 수신자만이 패킷을 분할할 수 있음. 대신 MTU(Path MTU Discovery) 기법을 통해 최적의 패킷 크기를 자동으로 조정
- 브로드캐스트 기능이 제거되었으며, 대신 멀티캐스트와 애니캐스트 방식이 사용
- DHCPv6를 통해 자동으로 할당하거나, 자동 구성 방식(SLAAC)을 통해 주소를 설정할 수 있음
- 각 필드의 맨 앞의 연속되는 0은 생략할 수 있으며 연속되는 0은 '::'로 표현될 수 있음. 단 '::'는 한번만 사용가능

<br>

### 2. 수많은 공유기에서는 고정 주소를 제공하는 기능의 동작방법
- 공유기에서 특정 장치에 항상 동일한 IP주소를 할당하는 방법을 DHCP 예약(DHCP Static Lease) 또는 고정 IP 주소 할당이라고 함

#### DHCP(Dynamic Host Configuration Protocol)
- 공유기는 네트워크에 연결된 장치에 동적으로 IP 주소를 할당하기 위해 DHCP 를 사용하는데 일반적으로 DHCP는 장치가 연결될 때 마다 사용가능한 IP 주소 중 하나를 임시로 할당
    - 하지만 DHCP에서 특정 장치에 항상 동일한 IP 주소를 할당하도록 예약하는 기능이 '고정 IP 주소 할당'
- 고정 주소 할당의 경우 장치가 항상 동일한 주소를 가지므로 가지는 장점은 다음과 같음
    - 네트워크에서 쉽게 식별하고 접근할 수 있어 연결 상태를 모니터링하기 용이
    - 포트 포워딩, 원격 액세스, 서버 설정 등 안정적인 연결 보장

#### DHCP 예약 동작 원리
- 고정 IP 주소는 장치의 MAC 주소를 기반으로 설정
    - MAC 주소는 장치의 네트워크 인터페이스에 할당된 고유한 식별자
- 공유기 설정에서 특정 MAC 주소에 대해 고정 IP 주소를 지정하고 이후 이 장치가 네트워크에 연결될 때 DHCP 서버는 항상 이 MAC 주소에 지정된 IP 주소를 할당

<br>

### 3. IPv4를 사용하는 장비와 IPv6를 사용하는 같은 네트워크 내에서 통신하는 방법
- 두 프로토콜은 상호 호환되지 않아 특정 방법이나 기술을 사용하여 두 프로토콜을 사용하는 장비 간에 통신을 가능하게 할 수 있음

#### 1. 듀얼 스택 (Dual Stack)
- 네트워크 장비가 IPv4와 IPv6 주소를 동시에 지원하도록 설정하는 방법
- 통신 시 IPv4 장비는 IPv4 주소를 사용하고, IPv6 장비는 IPv6 주소를 사용하여 서로 통신할 수 있음

#### 2. 터널링 (Tunneling)
- IPv6 패킷을 IPv4 패킷 안에 캡슐화하여 IPv4 네트워크를 통해 전달하는 방법
- 6to4 터널링 : IPv6 패킷을 IPv4 패킷에 캡슐화하여 IPv4 네트워크를 통해 전송하고 목적지에서 IPv6 패킷으로 복원
    - 이는 IPv6 네트워크 사이를 IPv4 네트워크를 통해 연결할 때 사용

#### 3. NAT64/DNS64
- IPv6 장비에서 IPv4 네트워크와 통신할 수 있도록 하는 네트워크 주소 변환 기술
- NAT64 : IPv6 장비가 IPv4 패킷으로 변환하는 기능 제공
    - IPv6 장비가 IPv4 장비에 접근할 때 NAT64 장비가 IPv6 주소를 IPv4 주소로 변환하여 통신을 가능하게 함
    - NAP64는 IPv6 패킷을 받아 IPv4 패킷으로 변환하고 반대로도 변환함. 프로토콜 트랜슬레이션 수행
- DNS64 : IPv6 장비가 IPv4 자원을 요청할 때 DNS64가 IPv4 주소를 IPv6로 변환하여 제공함으로써 NAT64를 통해 IPv4 자원에 접근할 수 있게함
    - IPv6 클라이언트가 www.example.com 같은 도메인 이름에 대해 DNS 요청을 보내면 DNS64 서버가 해당 도메인에 대한 A 레코드를 찾고 이 주소를 기반으로 프리픽스가 붙은 IPv6 주소 생성

#### 4. 프로토콜 트랜슬레이터
- 네트워크 장비 간에 서로 다른 프로토콜을 사용하는 경우 이를 번역해주는 트랜슬레이터 장비를 사용하여 통신을 가능하게 함
- 트랜슬레이터 장비가 중간에 위치하여 IPv4 트래픽을 IPv6로 변환하고 반대로 IPv6 트래픽을 IPv4로 변환하여 네트워크 간 원활한 통신을 지원

<br>

### 4. IP가 송신자와 수신자를 정확하게 전송되는 것의 보장 유무
- IP 자체로는 송수신자의 주소만을 의미하며 신뢰성있는 전송을 위해 TCP가 사용됨
- TCP 3-way handshake 를 사용한 신뢰성있는 연결
- 전송 데이터 패킷에 순서 번호(시퀀스 번호)를 기입하여 수신측에서 해당 번호를 바탕으로 재조립(멀티플렉싱)을 통한 확인이 가능
- 또한 해당 특정 번호를 송신받지 못하였다면 재전송 요청
- TCP는 송신자와 수신자 간의 데이터 전송 속도를 조절하여 네트워크 혼잡을 방지하고, 데이터가 손실되지 않도록함

<br>

### 5. IPv4에서 수행하는 Checksum과 TCP에서 수행하는 Checksum의 차이
= IPv4와 TCP의 체크섬은 모두 패킷이나 세그먼트가 전송 중 손상되었는지를 확인하는 기능이라는 부분에서 동일
- IPv4 체크섬은 IP 헤더만을 대상으로 하므로, 데이터(payload)의 무결성을 확인하지 않음
    - 이 체크섬은 패킷이 라우터를 지나갈때마다 변경될 수 있으며, 
- TCP 체크섬은 TCP 세그먼트 전체를 대상으로 하여 세그먼트 헤더와 데이터 페이로드, 의사 헤더 모두 검사
- 즉, 패킷 및 세그먼트에서의 손상 여부 확인 대상 범위 검사에서 차이

<br>

### 6. TTL(Hop Limit)
- TTL (Time To Live) 또는 Hop Limit은 IP 패킷의 라우팅 과정에서 사용되는 중요한 필드로 패킷이 네트워크를 통해 얼마나 라우터 수를 경유할지 지정할 수 있음
    - IP 패킷이 라우터를 거치며 감소하는데 이후 얼마나 패킷을 전송할 지 여부를 파악 가능
    - 패킷이 처음 생성될 때 송신자는 TTL 값을 설정
- TTL/Hop Limit은 패킷이 네트워크를 통해 몇 개의 라우터(홉)를 통과할 수 있는지를 제한하고 이 값을 통해 패킷이 네트워크 내에서 무한히 떠도는 것을 방지하고 네트워크 리소스를 보호함

<br>

### 7. IP 주소와 MAC 주소의 차이
- IP 주소는 네트워크에서 장치(호스트)를 식별하기 위해 사용하는 논리적 주소를 의미하고 MAC은 MAC 주소는 네트워크 인터페이스 카드(NIC)와 같은 장치에 고유하게 할당된 물리적 주소를 의미
- IP 주소는 네트워크 환경에 따라 유동적으로 변경될 수 있고 MAC 주소는 하드웨어의 고유한 주소로 일반적으로 변경되지 않음
- 네트워크 통신 시 MAC 먼저 접근하고 IP에 접근하게 됨
    - 네트워크 통신 시 장치간의 물리적인 데이터 전송은 MAC을 통해 전송하기 때문 (MAC 2계층, IP 4계층)
- ARP (Address Resolution Protocol)는 네트워크에서 IP 주소를 MAC 주소로 변환하기 위해 사용되는 프로토콜
- RARP (Reverse Address Resolution Protocol)는 ARP의 반대 역할을 하며, MAC 주소를 IP 주소로 변환하기 위해 사용

<br>

## Ssafy Wizards CS Study 2

### 서브넷 마스크 (Subnet Mask)와 게이트 웨이

#### 서브넷 마스크
- 서브넷 마스크는 IP 주소에서 네트워크와 호스트 부분을 구분하는 데 사용되는 32비트 숫자
- 서브넷팅을 통해 하나의 네트워크를 여러 개의 작은 네트워크(서브넷)으로 나누는 데 중요한 역할
- 네트워크 주소와 호스트 주소를 구분
    - 서브넷 마스크는 IP 주소의 어느 부분이 네트워크 주소를 나타내고, 어느 부분이 호스트 주소를 나타내는지를 정의
- 서브넷 마스크는 네트워크에서 IP 주소가 속한 서브넷을 식별하고, 같은 서브넷에 있는 장치 간의 통신을 가능하게함

```
IP 주소가 192.168.1.10이고 서브넷 마스크가 255.255.255.0인 경우

IP 주소     11000000 10101000 00000001 00001010
서브넷 마스크 11111111 11111111 11111111 00000000

- 255.255.255.0은 첫 24비트를 네트워크 부분으로, 나머지 8비트를 호스트 부분으로 설정
- 네트워크 주소: 192.168.1.0
- 호스트 주소: 10
```

<br>

#### 게이트웨이 (Gateway)
- 게이트웨이는 한 네트워크에서 다른 네트워크로 트래픽을 전달하는 출입구 역할을 하는 네트워크 장치
    - 일반적으로 라우터가 게이트웨이 역할도 수행하여 경계가 모호
- 게이트웨이는 네트워크 트래픽의 출입구 역할을 하며, 외부와의 연결을 관리. 일반적으로 네트워크에서 기본 게이트웨이는 라우터의 IP 주소로 설정됨
- 외부 네트워크로의 트래픽 전달
    - 로컬 네트워크 내의 장치들이 외부 네트워크(예: 인터넷)와 통신할 때, 게이트웨이가 데이터를 올바른 방향으로 전송
- 내부 네트워크 간의 라우팅
    - 여러 서브넷이 있는 네트워크에서, 게이트웨이는 서로 다른 서브넷 간의 트래픽을 라우팅

<br>

### 1. NAT (Network Address Translation)
- NAT는 내부 네트워크의 IP 주소를 외부 네트워크와 통신할 때 다른 IP 주소로 변환하는 기술
- 주로 라우터에서 설정되며, 사설 IP 주소를 공인 IP 주소로 변환하여 인터넷과 통신할 수 있게 함
- 주요 기능은 다음과 같음
    - 주소 변환: 사설 IP 주소를 공인 IP 주소로 변환하여 외부 네트워크와의 통신을 가능하게 함
    - IP 주소 절약: NAT를 사용하면 여러 내부 장치들이 하나의 공인 IP 주소를 공유할 수 있음
    - 보안 강화: 외부에서 내부 네트워크의 장치들을 직접적으로 볼 수 없기 때문에 보안 강화
- 유형은 다음과 같음
    - SNAT (Source NAT): 출발지 주소를 변환함. 주로 내부 네트워크에서 외부로 나가는 트래픽에 사용됨
    - DNAT (Destination NAT): 목적지 주소를 변환함. 주로 외부에서 내부 네트워크로 들어오는 트래픽에 사용됨
    - PAT (Port Address Translation): 여러 내부 장치가 하나의 공인 IP 주소를 사용해 외부와 통신할 때, 각 트래픽의 포트를 기반으로 구분하는 방식

<br>

### 2. 서브넷 마스크의 표현 방식
- 서브넷 마스크는 IP 주소와 마찬가지로 32비트의 이진수로 표현되며, 이를 다양한 방식으로 표현할 수 있음

#### 1.  도트 10진수 표기법 (Dotted Decimal Notation)
- 32비트의 서브넷 마스크를 8비트씩 4개의 그룹으로 나누어 각 그룹을 10진수로 표현하는 방식
    - 255.255.255.0
    - 이진수 : 11111111.11111111.11111111.00000000

#### 2.  슬래시 표기법 (CIDR 표기법)
- 서브넷 마스크를 슬래시(/)와 함께 사용하여, 네트워크 부분의 비트 수를 나타내는 방식
    - 예: /24
    - 이는 서브넷 마스크 255.255.255.0과 동일하며, 네트워크 부분 24비트 의미

#### 3.  이진수 표기법 (Binary Notation)
- 서브넷 마스크를 32비트의 이진수로 직접 표현하는 방식입니다.
    -  11111111.11111111.11111111.00000000
    - 서브넷 마스크 255.255.255.0에 해당
