# 프로세스 주소 공간 (Process Address Space)

### 프로세스 주소 공간
- 운영체제가 각각의 프로세스에 할당하는 가상의 메모리 영역
- 각 프로세스가 자신만의 독립적인 메모리 공간에서 실행될 수 있도록 하는 중요한 개념
    - 각각의 프로세스는 자신만의 주소공간을 가지며 다른 프로세스의 메모리에 직접 접근할 수는 없음
- 프로세스는 코드영역, 데이터 영역, 스택 영역, 힙영역으로 구성됨

#### 코드 영역 (code area)
- 프로그램의 본문이 기술된 곳으로 텍스트 영역(text area)라고도 함
- 프로그래머가 작성한 프로그램은 코드 영역에 탑재되며 탑재된 코드는 읽기 전용으로 처리됨. 자기 자신을 수정하는 프로그램은 존재하지 않기 때문

#### 데이터 영역 (data area)
- 코드가 실행되면서 사용하는 변수나 파일 등의 각종 데이터를 모아 놓은 곳
- 데이터는 변하는 값이기 때문에 이곳의 내용은 기본적으로 읽기와 쓰기가 가능
- 상수로 선언된 변수는 읽기 전용이지만 대부분의 변수는 읽기와 쓰기가 가능

#### 스택 영역 (stack area)
- 운영체제가 프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아놓은 곳
- 프로세스 내에서 함수를 호출하면 함수를 수행하고 원래 프로그램으로 되돌아올 위치를 이 영역에 저장
- 스택 영역은 운영체제가 사용자의 프로세스를 작동하기 위해서 유지하는 영역이므로 사용자에게는 보이지 않음(숨김 영역)

#### 힙 영역 (Heap area)
- 동적 메모리 할당을 위해 사용되는 메모리 공간으로, 런타임 중에 크기가 변동됨
- C/C++에서는 malloc(), calloc(), free()와 같은 함수로 동적 메모리를 할당하고 해제하며, Java, Python과 같은 언어에서는 가비지 컬렉터(Garbage Collector)가 메모리 관리를 수행
- 힙 영역은 메모리의 낮은 주소에서 높은 주소로 확장되며, 프로그램이 실행되는 동안 메모리를 필요에 따라 할당하고, 더 이상 필요하지 않을 경우 해제함
- 사용자가 직접 관리해야 하는 공간으로, 메모리 누수가 발생하지 않도록 주의해야 함
- 프로그램의 실행 중 할당된 힙 메모리는 명시적으로 해제하지 않으면 계속 유지되며, 종료 후에야 반환됨

<br>

## Ssafy Wizards CS Study

<br>

### 1. 초기화하지 않은 변수가 저장되는 곳
- 초기화되지 않은 전역 변수 및 정적 변수는 데이터 영역 에서 BSS(Block Started by Symbol) 영역에 저장됨
- 기존 데이터 영역에는 초기값이 있는 전역 변수와 정적 변수가 저장되어 이미 값을 가지고 있지만 초기화 되지 않은 전역 변수나 정적 변수는 BSS에 저장됨
    - 하지만 이후 값이 할당되어도 BSS 영역에서 메모리 상의 위치가 변경되지 않으며 BSS 내에서 할당된 값이 그대로 저장됨
- BSS에 저장된 변수는 프로그램이 실행될 때 메모리가 할당되지만, 실행 파일 자체에는 이 변수를 위한 데이터가 포함되지 않기 때문에 실행 파일 크기 측면에서 효율적
    - 프로그램 실행 시 이 변수들은 자동으로 0으로 초기화되어 메모리에 할당되고 파일 크기를 줄이는 효과가 있음
    - BSS 영역은 프로그램이 실행되기 전에 메모리가 할당되고 이에 들어있는 초기화 되지 않은 변수들은 아직 해당 메모리 영역에 할당하지 않고 있는 것
    - ex) int y;, static int z;

<br>

### 2. Stack과 Heap의 크기와 크기가 결정되는 순간
#### Stack
- 스택의 크기는 주로 운영체제에 의해 제한되어 일반적으로 실행 전에 크기가 고정됨
- 많은 시스템에서는 스택 크기를 기본 설정으로 사용하지만, 일부 시스템에서는 실행 시 옵션이나 설정 파일을 통해 스택 크기를 조정 가능
    - ex) <code>ulimit</code> 명령어를 통해 스택 크기를 조정

#### Heap
- 힙의 크기는 프로그램이 실행되면서 동적으로 필요에 따라 할당됨
- 개발자는 <code>malloc</code>이나 <code>new</code>와 같은 함수로 메모리를 요청하여 힙 공간을 사용할 수 있음
- 힙의 최대 크기는 시스템 메모리와 운영체제에 의해 제한됨

#### 개발자가 아닌 사용자가 이 크기를 결정할 수 있는지
- 대부분의 사용자는 직접적으로 스택 크기를 조정하지 않지만 일부 시스템에서는 제한을 설정하거나 조정할 수 있음
- 힙의 경우 개발자는 메모리를 동적으로 할당 및 해제할 수 있음

<br>

### 3. Stack과 Heap 중 접근이 더 빠른 곳
- stack이 heap 보다 더 빠르게 접근
- 스택은 LIFO 방식으로 메모리를 관리하며 연속된 메모리 공간에 데이터를 저장하고 접근하는 방식으로 캐시 지역성이 뛰어남
- 힙은 동적으로 메모리를 할당하고 해제하기 때문에 메모리 접근이 상대적으로 느리고 메모리 단편화가 발생할 수 있음

#### 메모리 단편화
- 메모리 단편ㅇ화란 메모리 할당과 해제 과정에서 사용할 수 있는 메모리 공간이 여러 조각으로 나뉘어 실제로 총 사용할 수 있는 공간은 남아있지만 효율적으로 사용하지 못하는 현상
- 크게 외부 단편화 (External Fragmentation)와 내부 단편화 (Internal Fragmentation)로 나눔
- 외부 단편화는 메모리 할당이 반복되면서 빈 메모리 공간이 여러 조각으로 분산되어, 총 사용 가능한 메모리는 충분하지만 필요한 크기의 연속된 공간을 확보하지 못해 메모리 할당이 실패하는 현상
- 내부 단편화는 할당된 메모리 블록 내에서 사용되지 않는 공간이 발생하는 현상. 요청된 메모리보다 더 큰 고정 크기의 블록이 할당되어, 남은 메모리 공간이 낭비됨

| **항목**            | **외부 단편화**                                         | **내부 단편화**                                         |
|---------------------|--------------------------------------------------------|--------------------------------------------------------|
| **정의**            | 사용 가능한 메모리가 작은 조각으로 나뉘어 할당 불가     | 할당된 블록 내 사용되지 않는 남은 공간                  |
| **발생 원인**       | 가변 크기 메모리 할당과 해제 과정에서 빈 공간이 분산됨  | 고정 크기 블록 할당 시 요청보다 큰 공간이 할당됨        |
| **해결 방법**       | **압축(Compaction)**: 메모리 조각들을 모아 연속된 공간 확보 | **세분화** 또는 **동적 할당** 방식 변경                |
| **효율성**          | 연속된 큰 공간 확보가 어려워 메모리 사용 비효율적       | 메모리 블록 내 사용되지 않은 공간이 생겨 메모리 낭비   |

<br>

### 4. 공간을 분할하는 이유
- 메모리는 하나이며 다양한 정보를 저장하는데 메모리 영역은 서로 다른 역할을 수행하도록 하여 공간을 분할하여 메모리 관리를 효율적이고 안전하게 이루어지도록 함
- 분할을 통해 메모리 관리가 효율적이고 안전하게 이루어질 수 있으며 각 영역의 메모리 액세스 패턴이 다르기 때문에 각 공간에 맞는 최적화가 가능
- 메모리 영역마다의 기능 간단 정리는 다음과 같음
    - 코드 영역: 실행할 명령어를 저장하고, 읽기 전용으로 설정하여 프로그램이 실수로 코드를 변경하지 않도록 보호
    - 데이터 영역: 전역 변수, 정적 변수를 저장하고 프로그램이 이 데이터를 사용할 수 있게 함
    - 스택: 함수 호출, 지역 변수, 리턴 주소 등을 관리하기 위한 임시 저장 공간
    - 힙: 프로그램이 동적으로 필요한 메모리를 요청할 때 사용하는 공간

<br>

### 5. 스레드의 주소 공간
- 스레드는 프로세스 내에서 실행되는 단위로 프로세스의 주소 공간을 공유함
- 모든 스레드는 하나의 프로세스 내에서 동일한 코드, 데이터, 힙 영역을 공유하지만, 각 스레드는 자신만의 스택을 가짐
- 스택은 스레드마다 독립적이며, 함수 호출과 지역 변수를 저장하고 스택은 스레드의 실행 흐름을 관리하는 역할을 함

<br>

### 6. "스택"영역과 "힙"영역은 정말 자료구조의 스택/힙과 연관?
- 스택 영역은 자료구조의 스택 방식과 유사하게 동작하여 함수 호출 시마다 스택 프레임이 추가되고, 함수가 종료되면 해당 스택 프레임이 제거되는 방식으로, 마지막에 들어간 데이터가 가장 먼저 나오는 구조
- 힙 영역은 자료구조의 힙(우선순위 큐 구현방법)과 연관은 없음. 힙 영역에서의 메모리 관리는 동적 할당이 이루어지는 메모리 공간을 의미하며, 메모리 할당 및 해제가 임의로 이루어지며 힙과는 다른 개념

<br>

### 7. IPC의 Shared Memory 기법은 프로세스 주소 공간 중 들어가는 곳
- Shared Memory(공유 메모리)는 프로세스간 메모리 공유를 위한 IPC(Inter-Process Communication) 방식
- 공유 메모리는 각 프로세스의 가상 주소 공간에 매핑되며, 일반적으로 힙 영역 또는 데이터 영역과 유사한 방식으로 동작
- 운영체제는 메모리 페이지를 매핑하여 각 프로세스가 동일한 물리적 메모리 공간을 참조하게 하여 프로세스 간의 빠른 데이터 교환이 가능하게 함