# Servlet

### Servlet
- 자바 서블릿(Java Servlet)이란 자바를 이용하여 웹 클라이언트의 요청에 대해 응답하는 역할을 수행하는 서버측 프로그램
- 즉 웹에서 요청을 처리하기 위한 자바 API로 웹 애플리케이션의 동적인 콘텐츠를 생성하는데 사용되는 자바 클래스
- JSP는 HTML 문서 안에 Java 코드를 포함하고 있는 반면 서블릿은 자바 코드안에 HTML을 포함함
    - Servlet : 주로 비지니스 로직과 웹 요청과 응답을 처리
    - JSP : 주로 프론트엔드 웹페이지의 디자인이나 뷰를 담당
- 서블릿은 서버에서 요청을 처리하기 위한 멀티스레딩을 통해 성능을 향상시킴
    - 여러 클라이언트의 요청을 각각의 스레드로 처리하여 성능 저하를 방지

<br>

### WAS (Web Application Server)
- 웹 프로그램이란 통상 원격지의 서버(server)에서 실행되는 프로그램
- 동적인 비지니스 로직을 처리하기 위해 웹 서버에서 별도의 프로그램을 이용하는데 이를 WAS라고 함
- 서버의 OS는 WAS가 설치되고 WAS는 웹 서비스를 처리함. 서비스를 외부에서 사용하기 위해서는 포트를 사용하는데 일반적으로 웹 서비스의 기본포트는 80
    - 개발용으로는 주로 8080 사용
- WAS는 여러 웹 애플리케이션을 포함하여 동작하기 때문에 
- WAS는 JEE(Java Enterprise Edition)을 구현하고 있어 이러한 JEE 기술을 기반으로 비지니스 로직을 처리할 수 있게함
- WAS의 종류에는 아파치 Tomcat, Netty 등이 존재

<br>

### Tomcat Servlet 이 Java Main 메서드 없이 실행되는 이유
- 서블릿은 일반적인 자바 애플리케이션과 다르게 Java main() 메서드 없이 동작함
- 이는 Tomcat은 자바 애플리케이션처럼 실행되며 main() 메서드를 사용하여 이 main() 메서드는 Tomcat이 실행되도록 하고, 그 안에서 서블릿 컨테이너가 시작됨
    - 하지만 Tomcat 자체는 main()으로 동작하지만 서블릿을 직접 실행하는 것이 아니라 서블릿을 실행할 환경(컨테이너)를 제공하는 역할을 함
    - 서블릿은 해당 Tomcat 안에서 동작하기 때문에 실행되는데 있어 main() 메서드가 따로 필요하지 않음
- 서블릿 컨테이너가 서블릿의 생명주기(lifecycle)을 관리하고 웹 애플리케이션의 실행 및 요청 처리를 자동으로 관리해주기 때문에
- 서버가 서블릿의 실행과 관리를 처리하므로 더 큰 규모의 웹 애플리케이션을 효율적으로 관리할 수 있음

<br>

### Container & Context?
- WAS는 여러 웹 어플리케이션을 포함해서 동작하며 관리하는 역할으로 Container 라고 부름
    - WAS가 Container 역할을 하고 컨테이너는 서블릿이나 JSP 같은 웹 애플리케이션을 실행하고 관리하는 책임을 가짐
    - Tomcat은 Servlet Container 라고도 불리며 웹 애플리케이션을 관리하고 HTTP 요청과 응답을 처리
- Context는 Container 안의 각각의 애플리케이션을 나타냄
    - 각 Context는 WAS 내에서 각 애플리케이션은 고유한 Context Root를 가지며 이 루트를 통해 외부에서 애플리케이션에 접근할 수 있음
    - 실제 사용자의 요청을 처리하는 것으로 하나의 웹 애플리케이션을 가르킴
    - 즉, Spring Application은 톰캣의 Context 중 하나

|Container Root|Context Root|
|:---:|:---:|
|WAS의 경로|http://192.168.0.1:8080|
|WAS에 설치된 Application|http://192.168.0.1:8080/**contextA**|

<br>

### Servlet 라이프사이클

#### 1. init()
- 서블릿 객체가 생성될 때 한 번 호출됨
- 서블릿의 초기화 작업을 담당하며 클라이언트 요청을 받기 전에 준비해야 할 작업을 처리함

#### 2. service()
- 서블릿이 요청을 받을 때마다 호출됨
- 이 메서드는 요청에 따라 doGet(), doPost() 같은 메서드를 호출하여 요청을 처리함

#### 3. destroy()
- 서블릿이 컨테이너에서 제거될 때 호출됨
- 서블릿이 종료되기 전, 정리해야할 리소스들을 처리함

<br>

### Servlet 멀티스레딩 구조
#### 1. 서블릿 인스턴스
- 서블릿은 싱글톤 패턴으로 작동하므로, 웹 서버는 요청이 올 때마다 매번 새로운 서블릿 인스턴스를 생성하지 않음
- 각 서블릿 클래스는 웹 서버가 시작될 때 단일 인스턴스만 생성됨

<br>

#### 2. 요청 처리 방식
- 각 클라이언트 요청이 올 때마다 서블릿 컨테이너는 새로운 스레드르 생성하고, 그 스레드가 서블릿 인스턴스의 service() 메서드를 호출하여 요청을 처리
- service() 메서드는 HTTP 요청 방식에 따라 doGet(), doPost()와 같은 메서드를 호출함

<br>

#### 3. 멀티스레딩의 장점
- 서블릿 하나의 인스턴스가 여러 스레드에서 동시에 사용됨으로써 여러 클라이언트 요청을 병렬로 처리할 수 있음
- 서버는 각 요청마다 별도의 스레드를 생성하여 독립적으로 처리하므로, 동시에 여러 요청이 들어와도 빠르게 응답할 수 있음

<br>

---

<br>

## Reference
- https://goodteacher.tistory.com/721