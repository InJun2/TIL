# 1Chapter 대규모 웹 서비스 개발 오리엔테이션

## 들어가기 앞서
- SE Study (개인스터디)를 통하여 웹 개발자를 위한 대규모 서비스를 지탱하는 기술을 스터디 진행한다.
- 해당 책은 지인의 CS 지식과 대규모 서비스를 다루는 방법을 잘 기록되어 있어 추천받았고 해당 책을 23-10-9 이후로 매일 스터디를 진행하여 한다.
- 현재 스터디 진행 방식은 각자 하루에 1챕터씩 독서 후 독서 내용을 스터디 진행시 30분 가량 이야기하는 것으로 한다.
- 현재 스터디는 2명이서 주로 독서 후 서로의 의견을 나누는 식으로 진행하며, 그 외 이해를 도와줄 1명으로 진행할 것 같다.


<br>

## 0Chapther
- 해당 내용은 이 책은 어떻게 만들어 졌는가를 설명하고 있는데 일본의 '하테나'라는 회사에서 주로 인턴십 강의를 토대로 만들어 두었고 주로 다음의 내용을 설명한다고 한다
    - 대규모 웹 서비스란
    - 대규모 데이터를 다룰 때의 과제, 다루기 위한 기본적인 사고방식과 요령
    - 알고리즘과 데이터 구조 선택의 중요성, 대규모 데이터를 예로 듦
    - RDBMS로 모두 다룰 수 없는 규모의 데이터 처리 방법
    - 대규모 서비스가 될 것을 전제로 한 서버/인프라 시스템의 예와 개념

<br>

## 1Chapter -1 대규모 서비스와 소규모 서비스
- 해당 책에서 대강 100대 ~ 수천대 가량의 서비스가 대규모 서비스로 이야기하고 있으며 페이스북 같은 수백만 대 이상의 서버를 초대규모라 부르고 있다
- 대규모와 소규모 서비스의 차이는 다음과 같다
    - 확장성과 부하분산 확보 : 주로 스케일아웃을 통해 확장하는데 서버가 여러대 일경우 요청을 분배하는 방법 (로드밸런서), 데이터동기화, 네트워크 통신의 지연시간(latency) 등의 차이가 있을 것이다
    - 다중성 확보 : 시스템은 다중성을 지닌 구성, 특정 서버가 고장나거나 성능이 저하되더라도 서비스를 계속할 수 있는 구성이 필요. 웹 서비스는 언제나 견고해야하며 언제 어떠한 경우에도 고장에 대해 견고해야함
    - 효율적 운용 필요 : 서버가 여러대 라면 서버가 정상적으로 동작하는지, 무슨 역할을 하는지 모호해질 수 있음. 부하는 괜찮은지, 고장난 부분은 없는지, 디스크 용량은 아직 충분한지, 보안 설정에 미비한 점은 없는지 서버에 대해 주로 자동화를 하게 되고 해당 대규모 서비스를 유지하기 위한 효율적 운용이 필요
    - 개발자 수, 개발 방법의 변화 : 혼자서는 개발이나 운용이 어려워지므로 여러 기술자가 역할을 분담. 사람이 많아지면 개발 표준화, 프로그래밍 언어와 프레임워크 통일, 코딩 규약 표준화 등을 통해 전체를 조정할 필요가 생김. 팀 매니지먼트가 필요해진다.
```
스케일아웃 (scale-out) : 서버를 횡으로 전개, 즉 서버의 역할을 분담하거나 대수를 늘림
스케일업 (scale-up) : 하드웨어의 성능을 높여 처리능력을 끌어올리는 방법
```
- 대규모 데이터에 대한 대처가 가장 중요한데 가장 큰 테마는 데이터 량이다.
- 컴퓨터는 디스크 -> 메모리 -> 캐시 메모리 -> CPU로 처리되는데 각 단계별로 속도차가 많이 난다. 디스크의 경우 헤드이동이나 이스크원반의 회전이라는 물리적 동작 등 많은 시간이 소요됨.
- 이 속도차를 흡수하기 위해 OS는 데이터를 메모리에 캐싱하는 등의 방법을 통해 극복하려하지만 데이터량이 많아지면 캐시미스가 발생하고 저속의 디스크로부터 I/O가 많이 발생하며 I/O 대기에 들어선 프로그램은 다른 리소스가 비어있더라도 읽기가 완료 될 때까지 다음 처리를 수행할 수 없고 시스템 전체적인 속도저하를 초래함
- 데이터가 적을 때는 간단한 알고리즘을 사용하는 것이 오버헤드가 적기 때문에 빠른 경우도 종종 있으므로 I/O 부하는 일단 문제가 되지 않으나 어느 정도 이상의 규모가 되면 문제가 복잡해진다
- 어떻게 하면 데이터를 적게 가져갈 수 있을지, 여러 서버로 분산시킬 수 있을지, 필요한 데이터를 최소한의 횟수로 읽어들일 수 있을지가 본질적 과제가 됨

<br>

## 1Chapter -2 계속 성장하는 서비스와 대규모화의 벽
- 해당 책에서 설명하는 서비스인 하테나는 처음에는 불안정하고 매우 소규모의 시스템이었으나 다른 서비스를 추가하면서 사용자수가 늘어났고 서비스가 정지해버리는 일이 빈번하게 일어나게 됨. 이후 다중화나 부하분산을 적용하였으나 해당 시기 상용 로드밸런서 등은 매우 고가여서 엄두조차 내지 못했음
- 해당 방법을 해결하기 위해 오픈소스 소프트웨어를 활용하였음. 라우터는 linux 박스, HTTP 요청 분산은 아파치의 mod_rewrite 대용, DB 분산은 불안정했던 MySQL 레플리케이션 기능을 사용하여 점차 확장
- 분산, 다중화, 효율적 운용 모두 좋지 않아 서비스가 다운되는 현상이 종종있어 엔지니어가 직접 서버를 재기동하는 응급처치를 했음
- 서버룸이 작아 더이상 서버 증설이 불가능해졌고 계속 증가해가는 트래픽이나 부하에 대처할 수 없어져 조직체제를 재점검하고 시스템 운용팀을 구성해서 이후의 대응하였음
- 이후 1년가량 작은 서버룸에서 인터넷 데이터 센터로 서버로 이전하는 작업을 시작하여 네크워크 설계를 근본적으로 재수정하고 낡은 서버는 모두 교체하는 방침을 채택
- 사전에 기존 시스템 부하상황을 정리해 서비스 구성 중 병목지점을 측정, 판정하고 I/O 부하가 높은 서버는 메모리를 중시하고 CPU 부하가 높은 서버는 CPU를 중요시하는 형태로 서버용도에 맞게 하드웨어 준비
- 다중화의 경우 로드밸런서 + 가동감시 기능을 하는 오픈소스 소프트웨어인 LVS + keepalived 도입, linus 박스 저가의 로드밸런서를 각 부분에 도입해 개선
- OS는 가상화를 통해 유지보수성을 높여가고 서버의 정보관리를 위해 독자적인 웹 기반 서버 정보관리 시스템 개발하여 서버의 용도나 부하상태와 같은 각종 정보에 엑세스하기 쉬워져 시스템 전체 파악 용이
- 서버/인프라 측면 시스템 구성 뿐만아닌 애플리케이션 각종 로직이나 DB 스키마 등을 재검토하여 비효율적인 부문을 배제하고 필요에 따라 독자적인 서브시스템을 개발하였음
- 시스템 성장전략으로는 서비스가 아직 소규모에서는 심플한 방법이 더 나은 경우가 많음. 너무 이른 최적화는 좋은 방법이 될 수 없고 웹 서비스가 상업적으로 히트할 가능성도 매우 낮음. 대규모의 벽은 갑자기 생기며 알아차렸을 경우 이미 시스템이 저속화되고 있는 경우가 많은데 이러한 사태를 발생시키지 않기위해 어느 정도의 수용능력 관리나 서비스 설계 시에 필요 이상으로 데이터를 증가시키지 않도록 하는 설계를 포함시키는 것이 좋을 것
- 해당 책은 필요 이상으로는 비용을 들이지 않고 미니멈 스타트할 수 있는 노하우를 보유하고 있다고 기술

<br>

## 1Chapter -3 서비스 개발의 현장
- 하테나의 커뮤니케이션 방법은 3가지 툴로 조합하여 지시를 주고받음
    - 하테나 그룹 : 블로그와 위키를 조합한 그룹웨어. 업무 리포트 보고에 사용하여 다른 담당자에게 작업을 의뢰할 경우 트랙백을 날림. 메일은 사용하지 않고 유지보수 등으로 시스템 작업이 발생한 경우 절차를 작업로그로 블로그나 위키에 정리해 참고할 수 있게함
    - IRC : 도쿄/쿄토로 사무실이 분산되어 있어 IRC 채팅 사용. 유지보수 진행사항이나 긴급문제, 간략한 용건은 IRC 이용
    - 서버관리툴 : 엔지니어 간 커뮤니케이션 툴로 사용. 현재 서버 상황을 한눈에 알 수 있는 툴로 개발 담당은 유지보수 예정 유무를 확인하거나 시스템을 갱신해도 되는지 판단
- 실제 서비스 개발 흐름은 다음과 같음
    1. 매일 아침 팀별로 10분 정도 미팅을 통해 어제 진척사항, 오늘 할일 공유
    2. 미팅에서 태스크 담당자를 정해 태스트 구현 진행
    3. 구현에 있어서는 최대한 테스트 프로그램을 작성. 레거시 서비스 등 테스트 프로그램이 어려운 서비스는 어느정도 타협이 필요
    4. 테스트 프로그램을 작성한 후 구현이 완료되면 버전관리 시스템에 커밋
    5. 구현이 끝나면 팀 내 다른 엔지니어에게 부탁하여 코드 리뷰 진행. 코드리뷰는 버그가 지적되거나 사내 코딩 규약에 따르지 않는 코드 발견, 과부하 유발 코드등이 밝혀지거나 개선될 수 있어 매우 유용한 수단
    6. 리뷰를 지나면 프로덕션 환경의 코드에 머지 하고 스테이징 환경에서 동작을 확인한 후 프로덕션 시스템에 반영
- 팀 내에서 프로그래밍 언어, 주요 미들웨어, 웹 애플리케이션 프레임워크 등을 통일하고 웹 서비스의 경우 수년 동안 계속 개발할 경우도 많아 그다지 유행에 좌우되지 않는 기본적인 프레임워크를 사용하는 것이 좋을 것 같다고 함
- OS는 VMware 나 coLinux 등의 가상 OS를 사용해 자유로 사용하고 버전 관리는 git, BTS(Bug Tracking System, 버그 추적 시스템)은 git repo를 연동한 독자 개발한 아사카 웹 애플리케이션을 사용
- 개발 툴은 지금까지 특별한 소프트웨어를 사용하는 것이 아니며 오히려 자사에서 개발한 프레임워크 등도 색다르게 만든 것이 아니며 기능도 적지만 대규모 개발에서는 고기능 툴 선택보다는 얼마나 효율성을 희생하지 않고 표준화 할 수 있는가, 자신의 Workflow에 맞게 사용할 수 있는가 같은 운용 방법을 어떻게 할것인지가 더 본질적인 과제


<br>


---

<div style="text-align: right">23-10-10</div>