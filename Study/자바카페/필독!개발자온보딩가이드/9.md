# 9장

## 9장 긴급 온콜 업무
- 온콜 업무 : 긴급 대응을 맡은 온콜 개발자는 일정에 따라 교대로 역할을 맡고 온콜 엔지니어는 반드시 장애를 분류하고 완화한 후 해결해야 한다. 온콜 교대 입무는 인수인계로 시작하고 끝나야 한다. 온콜 업무는 늘 분주하며 스트레스가 높은 경험이 될 수 있으나 장애와 지원 요청 모두를 처리할 수 있는 기본적인 스킬이 몇가지 있는데 항시 대응할 수 있는 가용성을 먼저 갖추고 장애를 넓은 시야로 볼 수 있어야 함
- 온콜 엔지니어 : 계획에 없던 업무나 프로덕션 환경 이슈, 일시적인 지원 요청을 처리. 주로 비상대기, 장애처리, 지원으로 구성됨
- 가용성은 성공적인 온콜 업무의 핵심. 온콜 업무는 요청과 알람에 대응하는 것으로 요청을 무시하거나 감춰서는 안됨. 가용성을 갖춘다고 해서 가장 최근 질문이나 문제를 처리하기 위해 하던 일을 즉시 멈춰야하는 것은 아니므로 자신이 해당 문제를 언제 살펴볼 수 있을지 예상해서 답변할 것
    - 온콜 업무와 관련된 정보는 채팅, 메일, 전화, 문자메시지, 티켓, 로그, 지표, 모니터링 도구 심지어 회의에 이르기까지 다양한 채널을 통해 전달되므로 해당 채널에 주의를 기울여야 함. 긴급 상황에서 참조할 수 있는 리스트 목록을 만들어 온콜 북마크 폴더를 별도로 지속적으로 관리하면 편리하며 다른사람도 필요에 따라 사용하고 개선할 수 있도록 목록을 팀과 공유하는 것도 좋은 방법임
- 우선순위가 가장 높은 작업부터 시작해라. 우선순위는 영향도에 따라 결정되므로 나와 요청자가 생각하는 우선순위가 다르다면 상사와 상의해볼 것. 서비스 수준 지표, 목표, 동의 또한 운영 업무의 우선순위를 정하는데 도움이 됨. 
        - 서비스 수준 지표 (SLI) : 에러율, 요청 레이턴시, 초당 요청 수 등과 같은 서비스 수준 지표를 살펴보는 것은 애플리케이션의 정상가동 여부를 판단하는 가장 쉬운 방법임
        - 서비스 수준 목표 (SLO) : 애플리케이션의 정상적인 동작을 위한 서비스 수준 지표 목표를 정의
        - 서비스 수준 동의 (SLA) : 서비스 수준 목표를 달성하지 못하였을 때 어떻게 될 것인지에 대해 동의한 내용
        - SLI는 가장 중요한 지표를 알 수 있으며, SLO와 SLA는 장애의 우선순위를 결정하는데 도움이 됨
- 명확하게 의사소통하자. 지원 업무에 응대할 때는 인내심을 갖고 예의를 갖추되 간결한 문장으로 소통하자.
- 업무 진척사항을 추적하자. 업무를 진행하면서 경과를 기록해두자. 이슈트래커나 팀의 온콜 로그에 기록하여 진척 상황을 추적해야 한다.
    - 이슈를 완화하거나 해결한 마지막 단계를 티켓에 추가해두면 동일한 이슈가 발생할 때 앞서 문서로 기록된 해결법을 참고할 수 있음
    - 이후 다른 온콜 엔지니어도 진행중인 업무의 상태를 파악할 수 있음
- 장애 처리의 5단계 : 장애 처리는 온콜 엔지니어의 가장 중요한 책임. 심각한 장애 상황에서 문제 해결도 중요하지만 최우선 목표는 문제의 영향을 완화하고 서비스를 복구하는 것이고 두번째 목표는 문제가 왜 어떻게 발생헀는지 나중에 분석할 수 있도록 정보를 수집하는 것. 장애 대응은 다섯 단계로 구분할 수 있음
    - 선별 : 엔지니어는 반드시 문제를 찾아내고 심각도를 파악한 후 누가 수정할지를 결정해야 한다
    - 조율 : 팀은 반드시 이슈에 대해 전달받아야한다. 온콜 엔지니어가 스스로 문제를 해결할 수 없다면 해결할 수 있는 사람을 찾아 알려야 한다
    - 완화 : 엔지니어는 반드시 최대한 빠른 시간 내에 서비스를 안정화해야한다. 완화는 장기적인 해결책은 아니지만 서비스를 지혈해야 한다
    - 해결 : 문제가 완화되면 엔지니어는 해결책에 대해 생각하고 작업할 시간을 벌게된다. 엔지니어는 문제에 대해 계속 조사하면서 그 원인을 파악하고 해결할 방법을 찾는다
    - 후속 조치 : 장애가 왜 발생했는지 근본적인 원인에 대한 조사를 수행하고 심각한 장애의 경우는 포스트 모텀이나 회고를 수행한다. 그리고 해당 문제가 다시 발생하지 않도록 후속 조치 업무를 만들어 둔다
- 포스트 모텀 : 의료계에서 사용되는 용어로 환자가 사망하고 사후조사를 수행해 기 결과를 기록하는 것에서 유래. 회고라는 단어를 대신 사용해도 무방
    - 포스트모텀 문서 작성은 온콜 엔지니어의 책임이며 이 문서에는 장애의 원인, 장애를 통해 알게된 내용, 향후 재발 방지를 위한 방안 등이 기록되어야 함
    - 포스트모텀의 가장 중요한 부분은 근본 원인 분석(RCA)절으로 "어째서?"라는 질문을 약 5번 가량 던져서 꼬리물기 식으로 찾아 왜 문제가 발생했는지 생각하고 원인에 대해 계속 생각하는 식
        - ex) 데이터 웨어하우스 데이터 누락 -> 커넥터가 데이터웨어 하우스에 데이터를 로드하지 않았음 -> 커넥터가 유입되는 메시지를 역직렬화 하지못함 -> 유입된 메시지에 손상된 헤어가 있었음 -> APM이 메시지에 잘못된 헤더 주입 .. 등등
- 온콜 엔지니어는 장애를 처리하지 않을 때는 지원 요청을 처리한다
    - 지원 요청도 엄연한 온콜 업무이며, 지원 요청은 조직 내의 임직원은 물론 외부 고객이 보낼 수도 있으며 스펙트럼이 넓지만 대부분의 요청은 버그 보고, 비즈니스 로직에 대한 질문, 소프트웨어 사용에 대한 기술적 질문이다
    - 지원 요청은 상당히 표준화된 흐름을 따르며 요청을 받으면 요청을 접수했음을 알리고 문제를 제대로 이해했는지 먼저 확인한다. 

<br>

## 이야기를 하면서 정리 및 생각되는 내용
- 이후 온콜 엔지니어가 따로 구성될지는 모르겠지만 시스템의 전체 흐름을 이해해야 할 필요성과 문서화의 중요성을 또 한번 느낀 것 같음
- 다른 스터디 참여 분들은 모두 온콜 엔지니어가 따로 구성되지는 않고 주로 도메인 담당자가 역할을 하게 되는 것 같음. 팀 내의 역할에 대해서는 어느정도 알아두고 지속적인 소통이 필요하다 느껴졌음
- 또한 팀원에 대한 비방이나 부정적인 감정 표출은 역시 좋지 않다고 생각함. 나도 실수를 하는 경우도 많고 해당 표출은 좋은 것이 없다고 느껴짐
- 이전에 책에서 현재 서비스가 잘 진행되고 있다면 선형 알고리즘도 나쁜 것이 아니며 다중화에서도 주로 마스터-슬레이브로 서버를 4대를 운용하는데 하나의 서버가 동작하지 않더라도 서버 하나는 계속 서비스를 지속해야하고 다른 한 서버는 복구할 수 있도록 사용한다고 되어있다. 이번 문서화나 지표라거나 완화 단계까지 빠르게 진행해야 하는 것을 보며 언제든 서비스를 지속하는게 소프트웨어 엔지니어의 역할이라고 생각되는 것 같음

---

<div style="text-align: right">23-11-01</div>